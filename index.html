<!DOCTYPE html>
<html lang="zh">
<head>
   <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: blob:; script-src * 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com; connect-src * 'self' wss://mingjin.pythonanywhere.com https://mingjin.pythonanywhere.com;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è°æ˜¯å§åº•åœ¨çº¿ç‰ˆ</title>
    <!-- SocketIO åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            text-align: center; 
            padding: 20px; 
            background-color: #f2f2f2;
            touch-action: manipulation; /* ä¼˜åŒ–æ‰‹æœºç‚¹å‡» */
        }
        .container { 
            background: white; 
            padding: 25px; 
            border-radius: 15px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            max-width: 500px; 
            margin: 0 auto; 
        }
        input { 
            padding: 12px; 
            width: 80%; 
            margin: 10px 0; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 16px; 
        }
        button { 
            width: 90%;
            padding: 15px; 
            background-color: #07c160; /* å¾®ä¿¡ç»¿ */
            color: white; 
            border: none; 
            border-radius: 8px; 
            font-size: 18px; 
            font-weight: bold;
            cursor: pointer; 
            margin-top: 10px;
        }
        button.red { background-color: #fa5151; }
        #gameArea, #wordArea { display: none; }
        ul { list-style: none; padding: 0; margin: 20px 0; }
        li { 
            padding: 10px; 
            background: #f9f9f9; 
            margin-bottom: 5px; 
            border-radius: 5px;
            font-size: 16px;
        }
        .big-word { 
            font-size: 40px; 
            font-weight: bold; 
            color: #333; 
            margin: 30px 0; 
            border: 2px dashed #07c160;
            padding: 20px;
            background: #f0fff4;
        }
        .tip { font-size: 12px; color: #888; margin-top: 20px; }
        .error-tip { color: #fa5151; font-size: 14px; margin: 10px 0; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ•µï¸ è°æ˜¯å§åº•</h2>
        <!-- æ–°å¢è¿æ¥å¤±è´¥æç¤º -->
        <div class="error-tip" id="connectError">âŒ è¿æ¥æ¸¸æˆæœåŠ¡å™¨å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼</div>
        
        <div id="loginArea">
            <input type="text" id="username" placeholder="è¾“å…¥ä½ çš„æ˜µç§°">
            <input type="text" id="room" placeholder="è¾“å…¥æˆ¿é—´å· (ä»…æ•°å­—ï¼Œå¦‚: 666)" value="666">
            <button onclick="joinGame()">åŠ å…¥æ¸¸æˆ</button>
            <p class="tip">å¤§å®¶è¦è¾“å…¥åŒä¸€ä¸ªæˆ¿é—´å·æ‰èƒ½ä¸€èµ·ç©å“¦</p>
        </div>
        
        <div id="gameArea">
            <h3>ğŸ  æˆ¿é—´: <span id="roomDisplay"></span></h3>
            <p>å·²åŠ å…¥ç©å®¶ (<span id="count">0</span>):</p>
            <ul id="playerList"></ul>
            <button onclick="startGame()">ğŸ® æˆ¿ä¸»ç‚¹å‡»ï¼šå¼€å§‹å‘ç‰Œï¼ˆä»…ä¸€äººç‚¹ï¼ï¼‰</button>
            <p class="tip">è‡³å°‘3äººæ‰èƒ½å¼€å§‹ï¼Œç­‰äººé½äº†å†ç‚¹å“¦ï½</p>
        </div>
        
        <div id="wordArea">
            <h3>ğŸ¤« ä½ çš„è¯è¯­æ˜¯ï¼š</h3>
            <div id="secretWord" class="big-word">???</div>
            <p style="color:#fa5151;">âš ï¸ é€€å‡ºæµè§ˆå™¨åè¯è¯­ä¼šæ¶ˆå¤±ï¼Œå»ºè®®æˆªå±ä¿å­˜ï¼</p>
            <button class="red" onclick="resetGame()">ğŸ”„ é‡ç½® / ä¸‹ä¸€å±€</button>
        </div>
    </div>

    <script>
        // å…³é”®ï¼šä¿®æ­£ä¸ºå…¨å°å†™çš„åç«¯åœ°å€ï¼
        const socket = io("https://mingjin.pythonanywhere.com", {
            // å¢åŠ è¿æ¥è¶…æ—¶é…ç½®
            timeout: 5000,
            reconnection: true
        }); 
        let myName = "";
        let myRoom = "";

        // æ–°å¢ï¼šè¿æ¥å¤±è´¥æç¤º
        socket.on('connect_error', () => {
            document.getElementById('connectError').style.display = 'block';
        });
        socket.on('connect', () => {
            document.getElementById('connectError').style.display = 'none';
        });

        function joinGame() {
            myName = document.getElementById('username').value.trim();
            myRoom = document.getElementById('room').value.trim();
            
            // æ ¡éªŒæ˜µç§°å’Œæˆ¿é—´å·
            if(!myName) return alert("å…ˆèµ·ä¸ªæ˜µç§°å§ï½");
            if(!/^\d+$/.test(myRoom)) return alert("æˆ¿é—´å·åªèƒ½æ˜¯æ•°å­—å“¦ï¼");
            
            socket.emit('join', {username: myName, room: myRoom});
            
            // åˆ‡æ¢ç•Œé¢
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('roomDisplay').innerText = myRoom;
        }

        // æ›´æ–°ç©å®¶åˆ—è¡¨
        socket.on('update_players', (data) => {
            const list = document.getElementById('playerList');
            list.innerHTML = "";
            data.players.forEach(p => {
                list.innerHTML += `<li>ğŸ‘¤ ${p}</li>`;
            });
            document.getElementById('count').innerText = data.players.length;
        });

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            socket.emit('start_game', {room: myRoom});
        }

        // æ¸¸æˆå¼€å§‹ï¼Œæ˜¾ç¤ºè¯è¯­
        socket.on('game_started', () => {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('wordArea').style.display = 'block';
            socket.emit('get_word', {username: myName, room: myRoom});
        });

        // æ˜¾ç¤ºè‡ªå·±çš„è¯è¯­
        socket.on('show_word', (data) => {
            document.getElementById('secretWord').innerText = data.word;
        });

        // é”™è¯¯æç¤º
        socket.on('error_msg', (data) => {
            alert(data.msg);
        });

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if(confirm("ç¡®å®šè¦é‡æ–°å¼€å§‹ä¸‹ä¸€å±€å—ï¼Ÿ")) {
                socket.emit('reset', {room: myRoom});
            }
        }

        // æ¥æ”¶é‡ç½®æŒ‡ä»¤ï¼Œåˆ‡å›æ¸¸æˆç•Œé¢
        socket.on('reset_game', () => {
            document.getElementById('wordArea').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('secretWord').innerText = "???";
        });
    </script>
</body>
</html>
